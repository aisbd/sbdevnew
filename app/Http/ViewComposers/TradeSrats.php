<?php/** * Created by PhpStorm. * User: sohail * Date: 4/16/2017 * Time: 12:13 PM */namespace App\Http\ViewComposers;use App\Market;use Illuminate\View\View;use App\Repositories\DataBanksIntradayRepository;use App\Repositories\DataBankEodRepository;use App\Repositories\InstrumentRepository;use DB;class TradeSrats{    /**     * Bind data to the view.     *     * @param  View  $view     * @return void     */    public function compose(View $view)    {        $instrument_id=13;        if(isset($viewdata['instrument_id']))            $instrument_id=(int)$viewdata['instrument_id'];        $market=\App\Market::getActiveDates();        $position_arr=array();        $latest_trade_data_all_instruments=DataBanksIntradayRepository::getLatestTradeDataAll();        $position_arr['price_change']="Not Traded";        $position_arr['price_change_per']="Not Traded";        $position_arr['total_volume']="Not Traded";        $position_arr['total_trades']= "Not Traded";        $position_arr['total_value']="Not Traded";        $total_shares_traded=count($latest_trade_data_all_instruments);        if(isset($latest_trade_data_all_instruments[$instrument_id]))        {/*            $sorted = $latest_trade_data_all_instruments->sortBy('price_change')->toArray();            $position_arr['price_change'] = array_search($instrument_id, array_keys($sorted));*/            $sorted = $latest_trade_data_all_instruments->sortBy('price_change_per')->toArray();            $position_arr['price_change_per'] = addOrdinalNumberSuffix(array_search($instrument_id, array_keys($sorted)));            $sorted = $latest_trade_data_all_instruments->sortBy('total_volume')->toArray();            $position_arr['total_volume'] = addOrdinalNumberSuffix(array_search($instrument_id, array_keys($sorted)));            $sorted = $latest_trade_data_all_instruments->sortBy('total_trades')->toArray();            $position_arr['total_trades'] = addOrdinalNumberSuffix(array_search($instrument_id, array_keys($sorted)));            $sorted = $latest_trade_data_all_instruments->sortBy('total_value')->toArray();            $position_arr['total_value'] = addOrdinalNumberSuffix(array_search($instrument_id, array_keys($sorted)));            $position_arr['total_shares_traded'] =$total_shares_traded;        }        $view->with('position_arr',$position_arr);    }}